# Example Story Cycle
# Demonstrates story cycle validation features in PyChivalry LSP

# Simple story cycle with all lifecycle hooks
training_regimen = {
    # Setup: Initialize when story begins
    on_setup = {
        set_variable = {
            name = training_start_date
            value = current_date
        }
        add_character_modifier = {
            modifier = in_training
            years = 5
        }
    }
    
    # Cleanup: Remove tracking when story ends
    on_end = {
        if = {
            limit = { exists = scope:story.story_owner }
            scope:story.story_owner = {
                trigger_event = training.completion
            }
        }
        remove_variable = training_start_date
    }
    
    # Death handling: Transfer to heir or end story
    on_owner_death = {
        if = {
            limit = { exists = primary_heir }
            primary_heir = {
                scope:story = {
                    make_story_owner = prev
                }
            }
        }
        else = {
            scope:story = {
                end_story = yes
            }
        }
    }
    
    # Effect group: Monthly skill progression
    effect_group = {
        months = 1
        
        triggered_effect = {
            trigger = {
                age >= 10
                age < 16
            }
            effect = {
                add_martial_skill = 100
                add_prowess_skill = 50
            }
        }
    }
    
    # Effect group: Annual milestones
    effect_group = {
        years = 1
        
        first_valid = {
            # Best case: has trainer
            triggered_effect = {
                trigger = { exists = var:trainer }
                effect = {
                    add_martial_skill = 300
                    trigger_event = training.milestone_trainer
                }
            }
            
            # Good case: has martial education
            triggered_effect = {
                trigger = { 
                    OR = {
                        has_education_martial_3 = yes
                        has_education_martial_4 = yes
                    }
                }
                effect = {
                    add_martial_skill = 200
                    trigger_event = training.milestone_educated
                }
            }
            
            # Fallback: basic progress
            triggered_effect = {
                trigger = { always = yes }
                effect = {
                    add_martial_skill = 100
                    trigger_event = training.milestone_basic
                }
            }
        }
    }
}

# Complex story cycle with multiple conditional effects
rival_scheme = {
    on_setup = {
        save_scope_as = rival_story
        
        set_variable = {
            name = rivalry_intensity
            value = 0
        }
    }
    
    on_end = {
        if = {
            limit = { exists = scope:story.story_owner }
            scope:story.story_owner = {
                if = {
                    limit = { var:rivalry_intensity >= 100 }
                    trigger_event = rivalry.climax
                }
                else = {
                    trigger_event = rivalry.fizzle
                }
            }
        }
    }
    
    on_owner_death = {
        # Rivalry ends on death
        scope:story = {
            end_story = yes
        }
    }
    
    # Fast pulse for opportunity checks
    effect_group = {
        days = 30
        
        triggered_effect = {
            trigger = {
                var:rivalry_intensity < 100
                any_scheme = {
                    scheme_target = scope:rival
                }
            }
            effect = {
                change_variable = {
                    name = rivalry_intensity
                    add = 5
                }
            }
        }
    }
    
    # Slow pulse for major events
    effect_group = {
        months = 6
        
        chance = 50
        
        triggered_effect = {
            trigger = {
                var:rivalry_intensity >= 50
                is_at_war = no
            }
            effect = {
                trigger_event = rivalry.confrontation
            }
        }
    }
    
    # Annual relationship deterioration
    effect_group = {
        years = 1
        
        trigger = {
            exists = scope:rival
            scope:rival = {
                is_alive = yes
            }
        }
        
        scope:rival = {
            add_opinion = {
                target = root
                modifier = rivalry_opinion
                opinion = -10
            }
        }
    }
}

# Minimal story cycle (demonstrates required elements)
simple_blessing = {
    effect_group = {
        years = 1
        add_piety = 50
    }
}

# Story cycle with timing validation examples
timing_examples = {
    # Valid: Simple integer timing
    effect_group = {
        days = 30
        add_gold = 10
    }
    
    # Valid: Monthly timing
    effect_group = {
        months = 6
        add_prestige = 50
    }
    
    # Valid: Yearly timing
    effect_group = {
        years = 2
        trigger_event = milestone.anniversary
    }
    
    # Note: Range syntax like { 30 60 } is valid but not fully
    # validated by parser yet - use simple integers for now
}
